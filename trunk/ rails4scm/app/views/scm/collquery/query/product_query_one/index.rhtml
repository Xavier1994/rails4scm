<html>
  <head>  
        <meta http-equiv="Content-Type" content="text/html; charset=GB2312">  
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="软件产品配置信息查询">
        <%= stylesheet_link_tag "style_table" %>
        <%= stylesheet_link_tag "common_style" %> 
        <%= javascript_include_tag "prototype" %>
  </head>
  <script language="javascript">
        function query(){
            document.forms[0].submit();
        }
        function queryItems(){
            produtcode=document.getElementById("product").value
            if (produtcode!=null&&produtcode!=""){
                url = "/scm/collquery/query/product_query_one/getvers?product_code=" + produtcode;
                var xmlHttp;
                if(window.ActiveXObject){
                    xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
                }else if(window.XMLHttpRequest){
                    xmlHttp=new XMLHttpRequest();
                }else {return;}
                var content="";//构造要携带的数据  
                xmlHttp.open("GET",url,false);//使用POST方法打开一个到服务器的连接，以异步方式通信  
                xmlHttp.send(null);//发送数据 
                if(xmlHttp.readystate==4) //请求状态为4表示成功
                    {
                    if(xmlHttp.status==200) //http状态200表示OK
                        {
                            document .getElementById ("ajaxver").innerHTML =xmlHttp.responseText; 
                        }
                    else //http返回状态失败
                        {
                            alert("服务端返回状态" + xmlHttp.statusText);
                        }
                    }
                else //请求状态还没有成功，页面等待
                    {
                        document .getElementById ("ajaxver").innerHTML ="数据加载中";
                    }
            }
        }
        if(event.keyCode == 13) {query();}
    </script>
<body>
<% form_tag :action =>'index' do %>
    <table cellpadding=0 cellspacing=0 border=0 width="1600px" height="100%">
      <tr height="20px">
       <td>
         <table>
           <tr>
             <td>
               <input type="checkbox" checked name="whereProduct" value="true">产品：
</td>
<td>
               <select style="width:100px" name="product" id="product" onchange="queryItems()">
                <option value=""></option>
                 <% for product in @products%>
                   <% if product.PRODUCT_CODE == @product%>
                     <option value="<%=product.PRODUCT_CODE%>" selected="true"><%=product.PRODUCT_NAME%></option>
                   <% else%>
                     <option value="<%=product.PRODUCT_CODE%>"><%=product.PRODUCT_NAME%></option>
                   <% end %>
                 <% end%>
               </select>
             </td>
            <td>
            <%
            if @whereProductVer!=nil&&@whereProductVer == "true" then
            %>
               <input type="checkbox" checked name="whereProductVer" value="true">
                 <%else %>
                   <input type="checkbox"  name="whereProductVer" value="true">
                    <%end %>
                     版本：
            </td>
            <td>
              <div id="ajaxver">
                <%if @verHtml!=nil then%>
                    <%=@verHtml%>
                <%else %>
                <select>
                </select>
            <%end%>
                 </div>
            </td>
            <td>
               <input type="button" value="查询" onclick="query()" class="btn3_mouseout">
             </td>
           </tr>
         </table>
       </td>
     </tr>
     <tr>
       <td valign="top">
         <table align="center" cellpadding=0 cellspacing=0 border=0 style="width:100%;bordercolor:#878787 ;border-left-style: solid; border-left-width: 1px; border-right-style: solid; border-right-width: 1px">
            <tr>
                <td class="td_header_bak2" width="70px">产品代码</td>
                <td class="td_header_bak3" width="100px">产品名称</td>
                <td class="td_header_bak3" width="80px">责任人</td>
                <td class="td_header_bak3" width="80px">配置项代码</td>
                <td class="td_header_bak3" width="100px">配置项名称</td>
                <td class="td_header_bak3" width="50px">版本号</td>
                <td class="td_header_bak3" width="100px">配置项分类</td>
                <td class="td_header_bak3" width="200px">存放位置</td>
                <td class="td_header_bak3" width="120px">状态日期</td>
                <td class="td_header_bak3" width="80px">状态</td>
            </tr>
<% 
if @items!=nil&&@items.size>0 then
    for item in @items%>
            <tr>
                <td class="td6">&nbsp;<%=item.PRODUCT_CODE%></td>
                <td class="td7">&nbsp;<%=item.PRODUCT_NAME%></td>
                <td class="td7">&nbsp;<%=item.PRODUCT_CONF_PERSON%></td>
                <td class="td7">&nbsp;<%=item.CONFIGURE_CODE%></td>
                <td class="td7">&nbsp;<%=item.CONFIGURE_NAME%></td>
                <td class="td7">&nbsp;<%=item.CONFIGURE_VERS%></td>
                <td class="td7">&nbsp;<%=item.CONFIGURE_TYPE%></td>
                <td class="td7">&nbsp;<%=item.CONFIGURE_STORE_ADDR%></td>
                <td class="td7">&nbsp;<%=item.STATE_DATE%></td>
                <td class="td7">&nbsp;<%=item.CUR_STATE%></td>
            </tr>
<%
    end 
    %>
    <tr>
                <td colspan="10">&nbsp;<%= will_paginate @items%>  </td>
            </tr>
  
  <%
else
  %>
            <tr>
                <td class="td6">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
                <td class="td7">&nbsp;</td>
            </tr>
            
  <%
end%>
            
        </table>
       </td>
     </tr>
    </table>
<%end%>

</body>
</html>